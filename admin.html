<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© | ØªØ³Ø¯ÙŠØ¯Ø© Ù…Ø­ØªØ±Ù</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main: #10b981; --sidebar: #0f172a; --bg: #f8fafc; --text: #334155; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* 1. Sidebar (Right 20%) */
        aside { width: 20%; background: var(--sidebar); color: white; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; box-shadow: 4px 0 15px rgba(0,0,0,0.1); }
        .logo { font-size: 22px; font-weight: 900; margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .logo span { color: var(--main); }
        
        .nav-link { padding: 15px; margin-bottom: 10px; border-radius: 12px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; font-weight: bold; color: #94a3b8; }
        .nav-link:hover, .nav-link.active { background: var(--main); color: white; transform: translateX(-5px); }
        .nav-link i { width: 25px; }

        /* 2. Main Content (Left 80%) */
        main { width: 80%; padding: 30px; overflow-y: auto; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title { font-size: 24px; font-weight: 900; color: var(--sidebar); }
        
        .card-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 15px; border: 1px solid #e2e8f0; border-right: 5px solid var(--main); box-shadow: 0 5px 20px rgba(0,0,0,0.03); }
        .stat-card h3 { margin: 0; font-size: 28px; color: var(--sidebar); }
        .stat-card p { margin: 5px 0 0; color: #64748b; font-size: 14px; }

        /* Tables */
        .table-container { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.03); }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: right; padding: 15px; background: #f8fafc; color: #64748b; font-size: 13px; border-bottom: 2px solid #e2e8f0; }
        td { padding: 15px; border-bottom: 1px solid #f1f5f9; font-weight: 600; font-size: 14px; }
        
        .status-pending { background: #fff7ed; color: #c2410c; padding: 5px 10px; border-radius: 20px; font-size: 12px; }
        .status-confirmed { background: #f0fdf4; color: #15803d; padding: 5px 10px; border-radius: 20px; font-size: 12px; }

        .btn-approve { background: var(--main); color: white; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; }
        .btn-reject { background: #ef4444; color: white; border: none; padding: 5px 10px; border-radius: 8px; cursor: pointer; }

        #loginScreen { position: fixed; inset: 0; background: var(--sidebar); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 40px; width: 350px; border-radius: 20px; text-align: center; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%; padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:8px;">
        <button onclick="login()" style="width:100%; padding:10px; background:var(--main); color:white; border:none; border-radius:8px; cursor:pointer;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<aside>
    <div>
        <div class="logo">ØªØ³Ø¯ÙŠØ¯Ø© <span>Ù…Ø­ØªØ±Ù</span></div>
        <div class="nav-link active" onclick="showSection('dash')"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="nav-link" onclick="showSection('bookings')"><i class="fas fa-calendar-check"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
        <div class="nav-link" onclick="showSection('financial')"><i class="fas fa-coins"></i> Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div>
        <div class="nav-link" onclick="showSection('settings')"><i class="fas fa-sliders-h"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</div>
    </div>
    <div class="nav-link" onclick="location.reload()" style="color:#ef4444;"><i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬</div>
</aside>

<main>
    <div class="header-bar">
        <div class="page-title">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</div>
        <div style="font-weight:bold;">Ù…Ø±Ø­Ø¨Ø§ØŒ Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ‘¤</div>
    </div>

    <div class="card-grid">
        <div class="stat-card">
            <h3 id="totalIncome">0 Ø±ÙŠØ§Ù„</h3>
            <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ„ÙŠ</p>
        </div>
        <div class="stat-card">
            <h3 id="totalComm">0 Ø±ÙŠØ§Ù„</h3>
            <p>ØµØ§ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</p>
        </div>
        <div class="stat-card">
            <h3 id="pendingCount" style="color:#f59e0b;">0</h3>
            <p>Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</p>
        </div>
    </div>

    <div id="bookingsSection" class="table-container">
        <h3 style="margin-top:0;">ğŸ“‹ Ø¢Ø®Ø± Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø¬Ø²</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ÙƒØ§Ø¨ØªÙ†</th>
                    <th>Ø§Ù„Ù…Ù„Ø¹Ø¨</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="bookingsTable"></tbody>
        </table>
    </div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfn2LhKnsVGQmoAK_HexN_6bm2-NICNSY",
      authDomain: "tasdida.firebaseapp.com",
      projectId: "tasdida",
      storageBucket: "tasdida.firebasestorage.app",
      messagingSenderId: "72604782215",
      appId: "1:72604782215:web:38a014c331634398d9f222"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let commRate = 10;

    window.login = async function() {
        const snap = await getDoc(doc(db, "settings", "config"));
        const real = snap.exists() ? snap.data().adminPassword : "123";
        commRate = snap.exists() ? Number(snap.data().commission) : 10;
        if(document.getElementById('passInput').value === real) {
            document.getElementById('loginScreen').style.display='none';
            loadData();
        }
    }

    window.loadData = async function() {
        const snap = await getDocs(collection(db, "bookings"));
        let income = 0;
        let pending = 0;
        const tbody = document.getElementById('bookingsTable');
        tbody.innerHTML = '';

        snap.forEach(d => {
            const data = d.data();
            const price = Number(data.price || 0);
            income += price;
            if(data.status === 'pending') pending++;

            const statusBadge = data.status === 'pending' 
                ? '<span class="status-pending">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>' 
                : '<span class="status-confirmed">Ù…Ø¤ÙƒØ¯</span>';
            
            const actions = data.status === 'pending' 
                ? `<button class="btn-approve" onclick="updateStatus('${d.id}', 'confirmed')"><i class="fas fa-check"></i></button> 
                   <button class="btn-reject" onclick="deleteBooking('${d.id}')"><i class="fas fa-times"></i></button>`
                : `<button class="btn-reject" onclick="deleteBooking('${d.id}')"><i class="fas fa-trash"></i></button>`;

            tbody.innerHTML += `
                <tr>
                    <td>${data.clientName}</td>
                    <td>${data.stadiumName}</td>
                    <td>${data.date}</td>
                    <td>${data.price}</td>
                    <td>${statusBadge}</td>
                    <td>${actions}</td>
                </tr>
            `;
        });

        document.getElementById('totalIncome').innerText = income + " Ø±ÙŠØ§Ù„";
        document.getElementById('totalComm').innerText = (income * (commRate/100)).toFixed(1) + " Ø±ÙŠØ§Ù„";
        document.getElementById('pendingCount').innerText = pending;
    }

    window.updateStatus = async function(id, status) {
        await updateDoc(doc(db, "bookings", id), { status: status });
        loadData();
    }

    window.deleteBooking = async function(id) {
        if(confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø² Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            await deleteDoc(doc(db, "bookings", id));
            loadData();
        }
    }
</script>
</body>
</html>
