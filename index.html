<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasdida - Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</title>
    <style>
        :root { --primary: #25d366; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; padding-bottom: 100px; color: var(--text); }
        .container { max-width: 600px; margin: 0 auto; }
        
        h2 { text-align: center; color: #075e54; margin-bottom: 20px; }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; transition: 0.2s; display: flex; align-items: center; gap: 15px; }
        .card:hover { transform: translateY(-2px); }
        .card.selected { border-color: var(--primary); background: #e8f5e9; }
        .card img { width: 70px; height: 70px; border-radius: 8px; object-fit: cover; background: #eee; }
        .stadium-info h3 { margin: 0 0 5px 0; font-size: 1.1em; }
        .price { color: var(--primary); font-weight: bold; }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        .input-group { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9em; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 15px; outline: none; }
        input:focus, select:focus { border-color: var(--primary); }

        /* Ø§Ù„Ø²Ø± Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 30px; width: 100%; max-width: 600px; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }
        .status-msg { margin-top: 10px; font-weight: bold; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h2>âš½ ØªØ·Ø¨ÙŠÙ‚ ØªØ³Ø¯ÙŠØ¯Ø©</h2>

    <div class="input-group">
        <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:</label>
        <input type="text" id="clientName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">

        <label>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</label>
        <input type="date" id="bookingDate">

        <label>â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ÙØ¶Ù„:</label>
        <select id="bookingTime">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª --</option>
            <option value="16:00">4:00 Ø¹ØµØ±Ø§Ù‹</option>
            <option value="17:00">5:00 Ø¹ØµØ±Ø§Ù‹</option>
            <option value="18:00">6:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="19:00">7:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="20:00">8:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="21:00">9:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="22:00">10:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="23:00">11:00 Ù…Ø³Ø§Ø¡Ù‹</option>
        </select>
    </div>

    <h3 style="margin-bottom: 10px;">ğŸŸï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨:</h3>
    <div id="stadiumsList"></div>
</div>

<div class="bottom-bar">
    <button id="bookBtn" class="btn-main" onclick="processBooking()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…</button>
    <div id="statusMsg" class="status-msg"></div>
</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // -------------------------------------------------------------
    // ğŸ”´ Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø®Ø§Øµ Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ Tasdida Ù‡Ù†Ø§
    // -------------------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyAfn2LhKnsVGQmoAK_HexN_6bm2-NICNSY",
  authDomain: "tasdida.firebaseapp.com",
  projectId: "tasdida",
  storageBucket: "tasdida.firebasestorage.app",
  messagingSenderId: "72604782215",
  appId: "1:72604782215:web:38a014c331634398d9f222",
  measurementId: "G-KV88C3MP0X"
    };

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„ØµÙˆØ±)
    const stadiums = [
        { id: 1, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© (Ø§Ù„Ø´Ù…Ø§Ù„)", price: 150, img: "https://images.unsplash.com/photo-1529900748604-07564a03e7a6?w=100" },
        { id: 2, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ§Ù…Ø¨ Ù†Ùˆ (Ø§Ù„Ø´Ø±Ù‚)", price: 200, img: "https://images.unsplash.com/photo-1459865264687-595d652de67e?w=100" },
        { id: 3, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠ (Ø§Ù„ÙˆØ³Ø·)", price: 120, img: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=100" }
    ];

    let selectedStadium = null;
    const adminPhone = "966500000000"; // ğŸ“± Ø¶Ø¹ Ø±Ù‚Ù…Ùƒ Ù‡Ù†Ø§

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    const container = document.getElementById('stadiumsList');
    stadiums.forEach(stadium => {
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => {
            selectedStadium = stadium;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            div.classList.add('selected');
        };
        div.innerHTML = `
            <img src="${stadium.img}" alt="Ù…Ù„Ø¹Ø¨">
            <div class="stadium-info">
                <h3>${stadium.name}</h3>
                <span class="price">${stadium.price} Ø±ÙŠØ§Ù„ / Ø³Ø§Ø¹Ø©</span>
            </div>
        `;
        container.appendChild(div);
    });

    // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø¬Ø² (ØªØ¹Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±)
    window.processBooking = async function() {
        const name = document.getElementById('clientName').value;
        const date = document.getElementById('bookingDate').value;
        const time = document.getElementById('bookingTime').value;
        const btn = document.getElementById('bookBtn');
        const msg = document.getElementById('statusMsg');

        // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (!name || !date || !time || !selectedStadium) {
            alert("âš ï¸ ÙØ¶Ù„Ø§Ù‹ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
        msg.innerText = "";

        try {
            // 2. ÙØ­Øµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø­Ø¬Ø² Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ù„Ø¹Ø¨ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚ØªØŸ
            // Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‡Ùˆ 'bookings' ÙƒÙ…Ø§ Ø£Ù†Ø´Ø£ØªÙ‡ Ø£Ù†Øª
            const q = query(collection(db, "bookings"), 
                where("stadiumId", "==", selectedStadium.id),
                where("date", "==", date),
                where("time", "==", time)
            );

            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                // â›” Ø§Ù„Ø­Ø¬Ø² Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹
                msg.innerText = "â›” Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ø¬ÙˆØ² Ù…Ø³Ø¨Ù‚Ø§Ù‹! Ø¬Ø±Ø¨ ÙˆÙ‚ØªØ§Ù‹ Ø¢Ø®Ø±.";
                msg.style.color = "red";
                btn.disabled = false;
                btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…";
                return;
            }

            // 3. Ø§Ù„Ø­ÙØ¸ ÙÙŠ ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙˆÙ‚Øª Ù…ØªØ§Ø­Ø§Ù‹)
            await addDoc(collection(db, "bookings"), {
                clientName: name,
                stadiumId: selectedStadium.id,
                stadiumName: selectedStadium.name,
                date: date,
                time: time,
                price: selectedStadium.price,
                createdAt: new Date() // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            });

            // 4. Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨
            msg.innerText = "âœ… ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¨Ù†Ø¬Ø§Ø­! Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨...";
            msg.style.color = "green";
            
            setTimeout(() => {
                const waMsg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ØªÙ… Ø­Ø¬Ø² *${selectedStadium.name}*\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\nâ° Ø§Ù„Ø³Ø§Ø¹Ø©: ${time}\nğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${selectedStadium.price} Ø±ÙŠØ§Ù„\n\nØ£Ø±Ø¬Ùˆ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø­Ø¬Ø².`;
                window.open(`https://wa.me/${adminPhone}?text=${encodeURIComponent(waMsg)}`, '_blank');
                location.reload(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ù„Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
            }, 1500);

        } catch (error) {
            console.error("Error:", error);
            msg.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
            msg.style.color = "red";
            btn.disabled = false;
            btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…";
        }
    }
</script>

</body>
</html>
