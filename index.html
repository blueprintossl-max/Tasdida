<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¯ÙŠØ¯Ø© Ù…Ø­ØªØ±Ù | Pro Striker</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #10b981; --dark: #0f172a; --bg: #f1f5f9; --glass: rgba(255,255,255,0.95); }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; color: var(--dark); user-select: none; }
        .container { max-width: 500px; margin: 0 auto; min-height: 100vh; position: relative; padding: 20px; }

        /* Header */
        .app-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-top: 10px; }
        .brand h1 { margin: 0; font-size: 24px; font-weight: 900; color: var(--dark); }
        .brand span { color: var(--primary); }
        .brand p { margin: 0; font-size: 12px; color: #64748b; font-weight: bold; }
        .user-avatar { width: 40px; height: 40px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #64748b; }

        /* iOS Style Icons Grid */
        .app-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .app-icon { 
            background: white; border-radius: 25px; padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; 
            cursor: pointer; transition: 0.3s; position: relative; overflow: hidden;
            border: 2px solid transparent; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 140px;
        }
        .app-icon:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.12); }
        .app-icon.active { border-color: var(--primary); background: #ecfdf5; }
        
        .icon-box { width: 60px; height: 60px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-bottom: 15px; color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .icon-booking { background: linear-gradient(135deg, #10b981, #059669); }
        .icon-match { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        
        .app-icon h3 { margin: 0; font-size: 16px; font-weight: 800; }
        .app-icon p { margin: 5px 0 0; font-size: 12px; color: #64748b; }

        /* Sections */
        .section-screen { display: none; background: white; border-radius: 25px; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); margin-top: 20px; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Inputs */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #64748b; }
        input, select { width: 100%; padding: 14px; border: 2px solid #f1f5f9; border-radius: 15px; font-family: 'Cairo'; outline: none; transition: 0.3s; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); background: #fff; }

        /* Price Tag */
        .price-display { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; margin-bottom: 15px; font-size: 18px; }

        /* Time Grid */
        .time-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .time-slot { padding: 10px; background: white; border: 1px solid #e2e8f0; border-radius: 10px; text-align: center; font-size: 12px; cursor: pointer; font-weight: bold; }
        .time-slot.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .time-slot.booked { background: #f1f5f9; color: #cbd5e1; pointer-events: none; text-decoration: line-through; }

        .btn-action { width: 100%; padding: 15px; background: var(--dark); color: white; border: none; border-radius: 15px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .back-btn { background: none; border: none; font-size: 14px; color: #64748b; cursor: pointer; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="app-header">
        <div class="brand">
            <h1>ØªØ³Ø¯ÙŠØ¯Ø© <span>Ù…Ø­ØªØ±Ù</span></h1>
            <p>Ù…Ø­Ø§ÙØ¸Ø© Ø§Ù„Ø¹Ø§Ø±Ø¶Ø©</p>
        </div>
        <div class="user-avatar"><i class="fas fa-user"></i></div>
    </div>

    <div id="homeScreen">
        <h3 style="margin-bottom:15px;">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
        <div class="app-grid">
            <div class="app-icon" onclick="openSection('bookingScreen')">
                <div class="icon-box icon-booking"><i class="far fa-calendar-check"></i></div>
                <h3>Ø­Ø¬Ø² Ù…Ù„Ø¹Ø¨</h3>
                <p>Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ø­Ø¬Ø²</p>
            </div>

            <div class="app-icon" onclick="openSection('matchScreen')">
                <div class="icon-box icon-match"><i class="fas fa-users"></i></div>
                <h3>Ø¨Ø­Ø« Ø¹Ù† ÙØ±ÙŠÙ‚</h3>
                <p>Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆÙ…Ø¨Ø§Ø±ÙŠØ§Øª</p>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #fff7ed; border-radius: 20px; border: 1px solid #ffedd5;">
            <h4 style="margin:0 0 5px 0; color:#c2410c;">ğŸ“£ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4>
            <div id="myRequests" style="font-size:13px; color:#9a3412;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ù†Ø´Ø·Ø©</div>
        </div>
    </div>

    <div id="bookingScreen" class="section-screen">
        <button class="back-btn" onclick="goHome()"><i class="fas fa-arrow-right"></i> Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        <h2 style="margin-top:0;">ğŸŸï¸ Ø­Ø¬Ø² Ù…Ù„Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        
        <div class="form-group">
            <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨</label>
            <select id="stadiumSelect" onchange="loadStadiumDetails()">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨ --</option>
            </select>
        </div>

        <div class="form-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø­Ø¬Ø² (ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø³Ø¹Ø±)</label>
            <select id="priceType" onchange="updatePrice()">
                <option value="normal">Ø£ÙŠØ§Ù… Ø¹Ø§Ø¯ÙŠØ©</option>
                <option value="holiday">Ø¹Ø·Ù„Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                <option value="season">Ù…ÙˆØ§Ø³Ù… / Ø±Ù…Ø¶Ø§Ù†</option>
            </select>
        </div>

        <div id="priceBox" class="price-display">0 Ø±ÙŠØ§Ù„ / Ø³Ø§Ø¹Ø©</div>

        <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²</label>
            <input type="date" id="bookDate" onchange="loadAvailability()">
        </div>

        <div class="form-group">
            <label>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</label>
            <div id="timeGrid" class="time-grid"></div>
        </div>

        <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ†</label>
            <input type="text" id="capName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
        </div>

        <button class="btn-action" onclick="submitBooking()">Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø­Ø¬Ø² <i class="fas fa-paper-plane"></i></button>
    </div>

    <div id="matchScreen" class="section-screen">
        <button class="back-btn" onclick="goHome()"><i class="fas fa-arrow-right"></i> Ø¹ÙˆØ¯Ø©</button>
        <h2>âš½ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙØ±ÙŠÙ‚/Ù„Ø§Ø¹Ø¨</h2>
        
        <p style="text-align:center; color:#777;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ†...</p>
        <div id="playersList"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAfn2LhKnsVGQmoAK_HexN_6bm2-NICNSY",
      authDomain: "tasdida.firebaseapp.com",
      projectId: "tasdida",
      storageBucket: "tasdida.firebasestorage.app",
      messagingSenderId: "72604782215",
      appId: "1:72604782215:web:38a014c331634398d9f222"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let currentStadium = null;
    let selectedSlots = [];

    async function init() {
        const sList = document.getElementById('stadiumSelect');
        const snap = await getDocs(collection(db, "stadiums"));
        snap.forEach(d => {
            const st = d.data();
            sList.innerHTML += `<option value="${d.id}">${st.name}</option>`;
        });
    }

    window.openSection = (id) => {
        document.getElementById('homeScreen').style.display = 'none';
        document.getElementById(id).style.display = 'block';
    }

    window.goHome = () => {
        document.querySelectorAll('.section-screen').forEach(s => s.style.display = 'none');
        document.getElementById('homeScreen').style.display = 'block';
    }

    window.loadStadiumDetails = async function() {
        const id = document.getElementById('stadiumSelect').value;
        if(!id) return;
        const snap = await getDoc(doc(db, "stadiums", id));
        currentStadium = snap.data();
        updatePrice();
        loadAvailability();
    }

    window.updatePrice = function() {
        if(!currentStadium) return;
        const type = document.getElementById('priceType').value;
        let p = currentStadium.basePrice || 0;
        if(type === 'holiday') p = currentStadium.priceHoliday || p;
        if(type === 'season') p = currentStadium.priceSeason || p;
        
        document.getElementById('priceBox').innerText = `${p} Ø±ÙŠØ§Ù„ / Ø³Ø§Ø¹Ø©`;
        currentStadium.currentPrice = p;
    }

    window.loadAvailability = async function() {
        const date = document.getElementById('bookDate').value;
        if(!date || !currentStadium) return;
        const grid = document.getElementById('timeGrid');
        grid.innerHTML = '...';
        
        selectedSlots = [];
        const q = query(collection(db, "bookings"), where("stadiumName", "==", currentStadium.name), where("date", "==", date));
        const snap = await getDocs(q);
        let booked = []; 
        snap.forEach(d => {
            // Ù†Ø£Ø®Ø° Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ "pending" Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¶Ø§Ø±Ø¨
            if(d.data().bookedSlots) booked.push(...d.data().bookedSlots);
        });

        grid.innerHTML = '';
        for(let h=16; h<=26; h++) {
            const div = document.createElement('div');
            div.className = 'time-slot' + (booked.includes(h) ? ' booked' : '');
            div.innerText = (h%12||12) + ':00';
            if(!booked.includes(h)) div.onclick = () => {
                div.classList.toggle('selected');
                selectedSlots.includes(h) ? selectedSlots = selectedSlots.filter(x=>x!==h) : selectedSlots.push(h);
            };
            grid.appendChild(div);
        }
    }

    window.submitBooking = async function() {
        const name = document.getElementById('capName').value;
        const date = document.getElementById('bookDate').value;
        if(!name || selectedSlots.length === 0) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const total = selectedSlots.length * currentStadium.currentPrice;
        
        // Ø§Ù„Ø­ÙØ¸ Ø¨Ø­Ø§Ù„Ø© "pending" (Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©)
        await addDoc(collection(db, "bookings"), {
            clientName: name, stadiumName: currentStadium.name, date,
            bookedSlots: selectedSlots, price: total, 
            status: "pending", // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
            createdAt: new Date().toISOString()
        });

        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø§Ù„Ùƒ! Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
        goHome();
        document.getElementById('myRequests').innerText = `Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©: ${currentStadium.name} (${date})`;
    }

    init();
</script>
</body>
</html>
