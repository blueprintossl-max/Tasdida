<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasdida - Ø­Ø¬Ø² Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨</title>
    <style>
        /* ... Ù†ÙØ³ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ... */
        :root { --primary: #25d366; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 20px; padding-bottom: 100px; color: var(--text); }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; display: flex; align-items: center; gap: 15px; }
        .card.selected { border-color: var(--primary); background: #e8f5e9; }
        .card img { width: 70px; height: 70px; border-radius: 8px; object-fit: cover; background: #eee; }
        .input-group { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 30px; width: 100%; max-width: 600px; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-main:disabled { background: #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; color: #075e54;">âš½ ØªØ·Ø¨ÙŠÙ‚ ØªØ³Ø¯ÙŠØ¯Ø©</h2>

    <div class="input-group">
        <label>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ:</label>
        <input type="text" id="clientName" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">
        <label>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²:</label>
        <input type="date" id="bookingDate">
        <label>â° Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ÙØ¶Ù„:</label>
        <select id="bookingTime">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª --</option>
            <option value="16:00">4:00 Ø¹ØµØ±Ø§Ù‹</option>
            <option value="17:00">5:00 Ø¹ØµØ±Ø§Ù‹</option>
            <option value="18:00">6:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="19:00">7:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="20:00">8:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="21:00">9:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="22:00">10:00 Ù…Ø³Ø§Ø¡Ù‹</option>
            <option value="23:00">11:00 Ù…Ø³Ø§Ø¡Ù‹</option>
        </select>
    </div>

    <h3 style="margin-bottom: 10px;">ğŸŸï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨:</h3>
    <div id="stadiumsList"></div>
</div>

<div class="bottom-bar">
    <button id="bookBtn" class="btn-main" onclick="processBooking()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…</button>
    <div id="statusMsg" style="margin-top:10px; font-weight:bold;"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ğŸ”´ğŸ”´ Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ Firebase Config Ù‡Ù†Ø§ ğŸ”´ğŸ”´
const firebaseConfig = {
  apiKey: "AIzaSyAfn2LhKnsVGQmoAK_HexN_6bm2-NICNSY",
  authDomain: "tasdida.firebaseapp.com",
  projectId: "tasdida",
  storageBucket: "tasdida.firebasestorage.app",
  messagingSenderId: "72604782215",
  appId: "1:72604782215:web:38a014c331634398d9f222",
  measurementId: "G-KV88C3MP0X"
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø°ÙŠ Ø³Ù†Ø¬Ù„Ø¨Ù‡ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    let adminPhone = ""; 

    // 1. Ø¬Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    async function fetchAdminPhone() {
        try {
            const docRef = doc(db, "settings", "config");
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                adminPhone = docSnap.data().adminPhone;
                console.log("ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø±Ù‚Ù…:", adminPhone);
            } else {
                console.log("Ù„Ù… ÙŠØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø¨Ø¹Ø¯!");
            }
        } catch (error) {
            console.error("Error fetching phone:", error);
        }
    }
    fetchAdminPhone(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø©

    const stadiums = [
        { id: 1, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© (Ø§Ù„Ø´Ù…Ø§Ù„)", price: 150, img: "https://images.unsplash.com/photo-1529900748604-07564a03e7a6?w=100" },
        { id: 2, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ§Ù…Ø¨ Ù†Ùˆ (Ø§Ù„Ø´Ø±Ù‚)", price: 200, img: "https://images.unsplash.com/photo-1459865264687-595d652de67e?w=100" },
        { id: 3, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠ (Ø§Ù„ÙˆØ³Ø·)", price: 120, img: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=100" }
    ];

    let selectedStadium = null;
    const container = document.getElementById('stadiumsList');
    
    stadiums.forEach(stadium => {
        const div = document.createElement('div');
        div.className = 'card';
        div.onclick = () => {
            selectedStadium = stadium;
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            div.classList.add('selected');
        };
        div.innerHTML = `
            <img src="${stadium.img}" alt="Ù…Ù„Ø¹Ø¨">
            <div class="stadium-info">
                <h3>${stadium.name}</h3>
                <span style="color:#25d366; font-weight:bold;">${stadium.price} Ø±ÙŠØ§Ù„</span>
            </div>
        `;
        container.appendChild(div);
    });

    window.processBooking = async function() {
        const name = document.getElementById('clientName').value;
        const date = document.getElementById('bookingDate').value;
        const time = document.getElementById('bookingTime').value;
        const btn = document.getElementById('bookBtn');
        const msg = document.getElementById('statusMsg');

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
        if (!adminPhone) {
            alert("âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… ÙŠÙ‚Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ù…Ù„Ø¹Ø¨ Ø¨Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.");
            return;
        }

        if (!name || !date || !time || !selectedStadium) {
            alert("âš ï¸ ÙØ¶Ù„Ø§Ù‹ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
        msg.innerText = "";

        try {
            const q = query(collection(db, "bookings"), 
                where("stadiumId", "==", selectedStadium.id),
                where("date", "==", date),
                where("time", "==", time)
            );

            const querySnapshot = await getDocs(q);

            if (!querySnapshot.empty) {
                msg.innerText = "â›” Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ø¬ÙˆØ² Ù…Ø³Ø¨Ù‚Ø§Ù‹!";
                msg.style.color = "red";
                btn.disabled = false;
                btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…";
                return;
            }

            await addDoc(collection(db, "bookings"), {
                clientName: name, stadiumId: selectedStadium.id, stadiumName: selectedStadium.name,
                date: date, time: time, price: selectedStadium.price, createdAt: new Date()
            });

            msg.innerText = "âœ… ØªÙ… Ø§Ù„Ø­Ø¬Ø²! Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨...";
            msg.style.color = "green";
            
            setTimeout(() => {
                const waMsg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ØªÙ… Ø­Ø¬Ø² *${selectedStadium.name}*\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“… ${date} | â° ${time}\nğŸ’° ${selectedStadium.price} Ø±ÙŠØ§Ù„\n\nØ£Ø±Ø¬Ùˆ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹.`;
                window.open(`https://wa.me/${adminPhone}?text=${encodeURIComponent(waMsg)}`, '_blank');
                location.reload();
            }, 1500);

        } catch (error) {
            console.error(error);
            msg.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
            btn.disabled = false;
        }
    }
</script>

</body>

</html>
