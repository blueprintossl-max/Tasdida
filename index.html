<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tasdida - Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆØ§Ù„Ù…Ø­ØªØ±ÙÙŠÙ†</title>
    <style>
        :root { --primary: #25d366; --dark: #075e54; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 15px; padding-bottom: 90px; color: #333; }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª */
        .tabs { display: flex; background: white; padding: 5px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-btn { flex: 1; padding: 12px; border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 16px; color: #777; border-radius: 10px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .card { background: white; padding: 15px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 2px solid transparent; transition: 0.2s; }
        .stadium-card { display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .stadium-card.selected { border-color: var(--primary); background: #e8f5e9; }
        .stadium-card img { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; }
        
        /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø§ÙƒØ² */
        .positions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; display: none; background: #fff8e1; padding: 10px; border-radius: 8px; }
        .pos-checkbox { display: flex; align-items: center; gap: 5px; font-size: 14px; font-weight: bold; }
        
        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© */
        .match-card { border-right: 5px solid #ff9800; position: relative; }
        .pos-tag { display: inline-block; background: #ff9800; color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px; margin-top: 5px; }
        .btn-join { background: #25d366; color: white; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 10px; width: 100%; font-weight: bold; cursor: pointer; }

        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ÙˆØ§Ù„Ø²Ø± */
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; outline: none; }
        .bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -4px 15px rgba(0,0,0,0.1); text-align: center; z-index: 100; }
        .btn-main { background: var(--dark); color: white; border: none; padding: 15px; width: 100%; max-width: 600px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; color: var(--dark); margin-bottom: 20px;">âš½ ØªØ·Ø¨ÙŠÙ‚ ØªØ³Ø¯ÙŠØ¯Ø©</h2>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('booking')">Ø­Ø¬Ø² Ù…Ù„Ø¹Ø¨ ğŸŸï¸</button>
        <button class="tab-btn" onclick="switchTab('matches')">Ø§Ù†Ø¶Ù… Ù„ÙØ±ÙŠÙ‚ ğŸ¤</button>
    </div>

    <div id="bookingSection">
        <div class="card">
            <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ø¨ØªÙ† (Ø§Ù„Ù…Ù†Ø¸Ù…):</label>
            <input type="text" id="clientName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
            
            <div style="display: flex; gap: 10px;">
                <div style="flex:1">
                    <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                    <input type="date" id="bookingDate">
                </div>
                <div style="flex:1">
                    <label>â° Ø§Ù„ÙˆÙ‚Øª:</label>
                    <select id="bookingTime">
                        <option value="">Ø§Ø®ØªØ±..</option>
                        <option value="16:00">4:00 Ù…</option>
                        <option value="17:00">5:00 Ù…</option>
                        <option value="18:00">6:00 Ù…</option>
                        <option value="19:00">7:00 Ù…</option>
                        <option value="20:00">8:00 Ù…</option>
                        <option value="21:00">9:00 Ù…</option>
                        <option value="22:00">10:00 Ù…</option>
                        <option value="23:00">11:00 Ù…</option>
                    </select>
                </div>
            </div>

            <div style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px;">
                <label style="display:flex; align-items:center; cursor:pointer; gap:10px;">
                    <input type="checkbox" id="needsPlayers" onchange="togglePositions()" style="width: 20px; height: 20px;">
                    <span style="font-weight:bold; color:#d35400;">ÙØ±ÙŠÙ‚ÙŠ Ù†Ø§Ù‚Øµ ÙˆØ£Ø­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ†!</span>
                </label>
                
                <div id="positionsBox" class="positions-grid">
                    <p style="grid-column: span 2; margin:0 0 5px 0; font-size:12px;">Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù†Ø§Ù‚ØµØ©:</p>
                    <label class="pos-checkbox"><input type="checkbox" value="Ø­Ø§Ø±Ø³" class="pos-select"> ğŸ§¤ Ø­Ø§Ø±Ø³</label>
                    <label class="pos-checkbox"><input type="checkbox" value="Ø¯ÙØ§Ø¹" class="pos-select"> ğŸ›¡ï¸ Ø¯ÙØ§Ø¹</label>
                    <label class="pos-checkbox"><input type="checkbox" value="ÙˆØ³Ø·" class="pos-select"> âš™ï¸ ÙˆØ³Ø·</label>
                    <label class="pos-checkbox"><input type="checkbox" value="Ù‡Ø¬ÙˆÙ…" class="pos-select"> âš½ Ù‡Ø¬ÙˆÙ…</label>
                </div>
            </div>
        </div>

        <h3 style="margin: 10px 0;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ø¹Ø¨:</h3>
        <div id="stadiumsList"></div>
    </div>

    <div id="matchesSection" style="display: none;">
        <div class="card" style="background:#e3f2fd; color:#0d47a1;">
            <p style="margin:0; font-size:14px;">â„¹ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ØªØ¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚ Ø§Ù„ØªÙŠ Ø­Ø¬Ø²Øª ÙˆØªØ¨Ø­Ø« Ø¹Ù† Ù†ÙˆØ§Ù‚Øµ. Ø§Ø®ØªØ± ÙØ±ÙŠÙ‚Ø§Ù‹ ÙˆØ§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ‡Ù…!</p>
        </div>
        <div id="matchesList"></div>
    </div>
</div>

<div class="bottom-bar" id="bottomBar">
    <button id="bookBtn" class="btn-main" onclick="processBooking()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² ÙˆÙ†Ø´Ø± Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // ğŸ”´ğŸ”´ Ø§Ù„ØµÙ‚ ÙƒÙˆØ¯ Firebase Config Ù‡Ù†Ø§ ğŸ”´ğŸ”´
  const firebaseConfig = {
  apiKey: "AIzaSyAfn2LhKnsVGQmoAK_HexN_6bm2-NICNSY",
  authDomain: "tasdida.firebaseapp.com",
  projectId: "tasdida",
  storageBucket: "tasdida.firebasestorage.app",
  messagingSenderId: "72604782215",
  appId: "1:72604782215:web:38a014c331634398d9f222",
  measurementId: "G-KV88C3MP0X"
};

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let adminPhone = "";
    
    // Ø¬Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
    getDoc(doc(db, "settings", "config")).then(snap => {
        if(snap.exists()) adminPhone = snap.data().adminPhone;
    });

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨
    const stadiums = [
        { id: 1, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© (Ø§Ù„Ø´Ù…Ø§Ù„)", price: 150, img: "https://images.unsplash.com/photo-1575361204480-aadea25e6e68?w=200" },
        { id: 2, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„ÙƒØ§Ù…Ø¨ Ù†Ùˆ (Ø§Ù„Ø´Ø±Ù‚)", price: 200, img: "https://images.unsplash.com/photo-1522770179533-24471fcdba45?w=200" },
        { id: 3, name: "Ù…Ù„Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠ (Ø§Ù„ÙˆØ³Ø·)", price: 120, img: "https://images.unsplash.com/photo-1459865264687-595d652de67e?w=200" }
    ];

    let selectedStadium = null;
    const stContainer = document.getElementById('stadiumsList');
    
    stadiums.forEach(st => {
        const div = document.createElement('div');
        div.className = 'card stadium-card';
        div.onclick = () => {
            selectedStadium = st;
            document.querySelectorAll('.stadium-card').forEach(c => c.classList.remove('selected'));
            div.classList.add('selected');
        };
        div.innerHTML = `
            <img src="${st.img}">
            <div>
                <h3 style="margin:0 0 5px 0;">${st.name}</h3>
                <span style="color:#25d366; font-weight:bold;">${st.price} Ø±ÙŠØ§Ù„ / Ø³Ø§Ø¹Ø©</span>
            </div>
        `;
        stContainer.appendChild(div);
    });

    // Ø¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ²
    window.togglePositions = function() {
        const box = document.getElementById('positionsBox');
        box.style.display = document.getElementById('needsPlayers').checked ? 'grid' : 'none';
    }

    // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    window.switchTab = function(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        if(tab === 'booking') {
            document.getElementById('bookingSection').style.display = 'block';
            document.getElementById('matchesSection').style.display = 'none';
            document.getElementById('bottomBar').style.display = 'block';
        } else {
            document.getElementById('bookingSection').style.display = 'none';
            document.getElementById('matchesSection').style.display = 'block';
            document.getElementById('bottomBar').style.display = 'none';
            loadMatches();
        }
    }

    // Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø¬Ø²
    window.processBooking = async function() {
        const name = document.getElementById('clientName').value;
        const date = document.getElementById('bookingDate').value;
        const time = document.getElementById('bookingTime').value;
        const needsPlayers = document.getElementById('needsPlayers').checked;
        const btn = document.getElementById('bookBtn');

        // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        let wantedPositions = [];
        if(needsPlayers) {
            document.querySelectorAll('.pos-select:checked').forEach(cb => wantedPositions.push(cb.value));
            if(wantedPositions.length === 0) return alert("âš ï¸ Ø§Ø®ØªØ±Øª Ø£Ù†Ùƒ ØªØ­ØªØ§Ø¬ Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©!");
        }

        if(!name || !date || !time || !selectedStadium) return alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…...";

        try {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙØ±
            const q = query(collection(db, "bookings"), 
                where("stadiumId", "==", selectedStadium.id), 
                where("date", "==", date), 
                where("time", "==", time));
            
            const check = await getDocs(q);
            if(!check.empty) {
                alert("â›” Ù‡Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ù…Ø­Ø¬ÙˆØ² Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
                btn.disabled = false; btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² âœ…";
                return;
            }

            // Ø§Ù„Ø­ÙØ¸
            await addDoc(collection(db, "bookings"), {
                clientName: name,
                stadiumId: selectedStadium.id,
                stadiumName: selectedStadium.name,
                date: date, time: time, price: selectedStadium.price,
                needsPlayers: needsPlayers,
                wantedPositions: wantedPositions,
                paidToOwner: false,
                createdAt: new Date().toISOString()
            });

            // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„
            alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
            
            let msg = `Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯: ${selectedStadium.name}\nğŸ‘¤ ${name}\nğŸ“… ${date} Ø§Ù„Ø³Ø§Ø¹Ø© ${time}\nğŸ’° ${selectedStadium.price} Ø±ÙŠØ§Ù„`;
            if(needsPlayers) msg += `\nâš ï¸ Ù…Ø·Ù„ÙˆØ¨ Ù„Ø§Ø¹Ø¨ÙŠÙ†: ${wantedPositions.join('ØŒ ')}`;
            
            window.open(`https://wa.me/${adminPhone}?text=${encodeURIComponent(msg)}`, '_blank');
            location.reload();

        } catch (e) {
            console.error(e);
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª");
            btn.disabled = false;
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    async function loadMatches() {
        const list = document.getElementById('matchesList');
        list.innerHTML = '<p style="text-align:center">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</p>';
        
        const q = query(collection(db, "bookings"), where("needsPlayers", "==", true));
        const snap = await getDocs(q);
        
        list.innerHTML = '';
        if(snap.empty) { list.innerHTML = '<p style="text-align:center; margin-top:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ØªØ¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; return; }

        snap.forEach(doc => {
            const data = doc.data();
            // Ø¹Ø±Ø¶ ÙÙ‚Ø· Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© (ÙÙ„ØªØ±Ø© Ø¨Ø³ÙŠØ·Ø©)
            if(new Date(data.date) >= new Date().setHours(0,0,0,0)) {
                let tagsHtml = '';
                if(data.wantedPositions) {
                    data.wantedPositions.forEach(p => tagsHtml += `<span class="pos-tag">${p}</span>`);
                }
                
                list.innerHTML += `
                    <div class="card match-card">
                        <h3 style="margin:0 0 5px 0;">${data.stadiumName}</h3>
                        <p style="margin:5px 0; color:#555;">ğŸ“… ${data.date} | â° ${data.time}</p>
                        <p style="margin:5px 0; font-size:14px;">ğŸ‘¤ Ø§Ù„ÙƒØ§Ø¨ØªÙ†: ${data.clientName}</p>
                        <div style="margin-top:5px;"><strong>Ù…Ø·Ù„ÙˆØ¨:</strong> ${tagsHtml || 'Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¹Ø§Ù…'}</div>
                        <button class="btn-join" onclick="joinTeam('${data.clientName}', '${data.stadiumName}')">ğŸ“© ØªÙˆØ§ØµÙ„ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</button>
                    </div>
                `;
            }
        });
    }

    window.joinTeam = function(captain, stadium) {
        const playerPos = prompt("Ù…Ø§ Ù‡Ùˆ Ù…Ø±ÙƒØ²ÙƒØŸ (Ø­Ø§Ø±Ø³ØŒ Ø¯ÙØ§Ø¹ØŒ Ù‡Ø¬ÙˆÙ…..)");
        if(playerPos) {
            const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙƒØ§Ø¨ØªÙ† ${captain} ğŸ‘‹\nØ±Ø£ÙŠØª Ø·Ù„Ø¨ÙƒÙ… ÙÙŠ Ù…Ù„Ø¹Ø¨ ${stadium}.\nØ£Ù†Ø§ Ø£Ù„Ø¹Ø¨ ÙÙŠ Ù…Ø±ÙƒØ² (${playerPos}) ÙˆØ£Ø±ØºØ¨ Ø¨Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„ÙƒÙ….`;
            window.open(`https://wa.me/${adminPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }
    }
</script>
</body>
</html>

